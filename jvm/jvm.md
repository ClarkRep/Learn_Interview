# JVM 虚拟机

Java与C++之间有一堵由内存动态分配和垃圾收集技术所围成的“高墙”，墙外面的人想进去，墙里面的人却想出来。  --《深入理解JAVA虚拟机》

## 1、运行时数据区域
Java 虚拟机所管理的内存将会包括以下几个运行时数据区域：  

![Java 虚拟机运行时数据区](jvm_memory_model.png)  

* **方法去**、**堆**是**线程共享**的；
* **虚拟机栈**、**本地方法栈**、**程序计数器**是**线程私有**的。

### 1.1、程序计数器
**程序计数器**是一块较小的内存空间，它可以看作是当前线程所执行的字节码的行号指示器。  
由于Java 虚拟机的多线程是通过线程轮流切换并分配处理器执行时间来实现的，在任何一个确定的时刻，一个处理器（对于多核处理器来说是一个内核）
都只会执行一条线程中的指令。  
因此，为了线程切换后能恢复到正确的执行位置，每条线程都需要有一个独立的**程序计数器**，各条线程之间计数器互不影响，独立存储，我们称这类内存区域为**线程私有**的内存。  
* 如果线程正在执行的是一个 Java 方法，这个计数器记录的是正在执行的虚拟机字节码指令的地址；  
* 如果正在执行的是 Native 方法，这个计数器值则为空（Undefined）；
* 此内存区域是唯一一个在Java 虚拟机规范中没有规定任何 OutOfMemoryError 情况的区域。

### 1.2、Java虚拟机栈
Java虚拟机栈是**线程私有**的，它的生命周期与线程相同。  
虚拟机栈描述的是**Java方法**执行的内存模型：每个**方法**在执行的同时都会创建一个**栈帧**用于存储局部变量表、操作数栈、动态链接、方法出口等信息，每一个方法从调用直至执行完成的过程，就对应着一个**栈帧**在虚拟机栈中入栈到出栈的过程。  
**栈帧**的结构如下图所示：  
![Java 虚拟机栈栈帧结构图](jvm_stack_frame.jpeg)
